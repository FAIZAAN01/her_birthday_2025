<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
    <title>Ultra-Quality Moving Button Game</title>
    <style>
        :root {
            --primary-gradient: linear-gradient(45deg, #ff6a00, #ee0979);
            --secondary-gradient: linear-gradient(45deg, #12c2e9, #c471ed);
            --popup-size: clamp(80px, 8vw, 120px);
        }

        html,
        body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
            color: #fff;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }

        #buttonsContainer {
            display: flex;
            gap: 20px;
        }

        button {
            padding: 1.2vw 2.5vw;
            font-size: clamp(14px, 1.2vw, 18px);
            min-width: 100px;
            min-height: 50px;
            border: none;
            border-radius: 12px;
            font-weight: bold;
            cursor: pointer;
            color: #fff;
            background: var(--primary-gradient);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.5);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        button:hover {
            transform: scale(1.1);
            box-shadow: 0 12px 25px rgba(0, 0, 0, 0.7);
        }

        #feedbackGif,
        #caughtMessage,
        #countdown,
        #attemptsCounter {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
        }

        #feedbackGif {
            top: 2vh;
            width: clamp(120px, 18vw, 220px);
            border-radius: 10px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.7);
            display: none;
        }

        #attemptsCounter {
            top: 20vh;
            font-size: clamp(16px, 1.6vw, 22px);
            color: #ffd700;
            text-shadow: 0 0 8px #ffea00;
        }

        #countdown {
            top: 30vh;
            font-size: clamp(32px, 4vw, 48px);
            font-weight: bold;
            color: #ff4444;
            text-shadow: 0 0 15px #ff4444;
            animation: pulse 1s infinite;
            display: none;
        }

        #caughtMessage {
            top: 40vh;
            font-size: clamp(24px, 3vw, 36px);
            color: #00ff88;
            font-weight: bold;
            display: none;
            animation: bounce 1s ease-in-out;
            text-shadow: 0 0 12px #00ff88;
        }

        #toggleContainer {
            position: absolute;
            top: 50px;
            right: 50px;
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 10px 20px;
            border-radius: 20px;
            background: rgba(0, 0, 0, 0.4);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(8px);
            font-size: clamp(12px, 1.2vw, 18px);
        }

        .toggleSwitch {
            position: relative;
            width: 60px;
            height: 34px;
        }

        .toggleSwitch input {
            display: none;
        }

        .slider {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border-radius: 34px;
            background: var(--primary-gradient);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
            transition: 0.4s;
            cursor: pointer;
        }

        .slider:before {
            content: "";
            position: absolute;
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            border-radius: 50%;
            background: #fff;
            transition: 0.4s;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
        }

        input:checked+.slider {
            background: var(--secondary-gradient);
        }

        input:checked+.slider:before {
            transform: translateX(26px);
        }

        @keyframes pulse {

            0%,
            100% {
                transform: translateX(-50%) scale(1);
            }

            50% {
                transform: translateX(-50%) scale(1.3);
            }
        }

        @keyframes bounce {

            0%,
            100% {
                transform: translateX(-50%) translateY(0);
            }

            50% {
                transform: translateX(-50%) translateY(-25px);
            }
        }

        .popup {
            position: absolute;
            width: var(--popup-size);
            z-index: 20;
            border-radius: 8px;
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.5);
            transition: transform 0.3s ease;
            pointer-events: auto;
        }

        .popup:hover {
            transform: scale(1.1);
        }
    </style>
</head>

<body>
    <div id="buttonsContainer">
        <button id="trickyBtn">Catch me!</button>
        <button id="staticBtn">I'm Static</button>
    </div>

    <img id="feedbackGif" alt="feedback" />
    <!-- <div id="attemptsCounter">Attempts: 0</div> -->
    <div id="countdown">READY!</div>
    <div id="caughtMessage">You caught it hehe!</div>

    <div id="toggleContainer">
        <span>Disable Moving Button</span>
        <label class="toggleSwitch">
            <input type="checkbox" id="disableToggle">
            <span class="slider"></span>
        </label>
    </div>

    <script>
        // ----- DOM refs -----
        const btn = document.getElementById('trickyBtn');
        const staticBtn = document.getElementById('staticBtn');
        const gif = document.getElementById('feedbackGif');
        const attemptsDiv = document.getElementById('attemptsCounter');
        const countdownDiv = document.getElementById('countdown');
        const caughtMessage = document.getElementById('caughtMessage');
        const disableToggle = document.getElementById('disableToggle');

        // ----- config -----
        const MAX_POPUPS = 50;
        const SPAWN_INTERVAL = 300;
        const popupElements = [];
        const margin = 50;

        // ----- state -----
        let attempts = 0;
        let isCaught = false;
        let isDisabled = false;
        let popupRaf = null;
        let lastSpawn = 0;
        let gifTimeout = null;

        // ----- media arrays -----
        const feedbackMedia = [
            'gifs/sad panda GIF.gif',
            'gifs/happy hamster GIF.gif',
            'gifs/Panda Spinning GIF.gif'
        ];

        const popupImages = [
            'https://media.giphy.com/media/3o6Zt6ML6BklcajjsA/giphy.gif',
            'https://media.giphy.com/media/xT0xezQGU5xCDJuCPe/giphy.gif',
            'https://media.giphy.com/media/26gssIytJvy1b1THO/giphy.gif',
            'gifs/Animated.gif',
            'gifs/walking_dudu.gif',
            'gifs/Cat Girl GIF.gif',
            'gifs/clannad GIF.gif',
            'gifs/Funny GIF.gif',
        ];

        const specialCountdownGif = 'gifs/catdance.gif';

        // ----- helpers -----
        function isGif(src) {
            return /\.gif(\?|$)/i.test(src);
        }

        function clearGifTimeout() {
            if (gifTimeout) {
                clearTimeout(gifTimeout);
                gifTimeout = null;
            }
        }

        function showGif(src, duration = null) {
            clearGifTimeout();
            gif.src = src;
            gif.style.display = 'block';
            const dur = duration ?? (isGif(src) ? 2000 : 4000);
            gifTimeout = setTimeout(() => {
                gif.style.display = 'none';
                gifTimeout = null;
            }, dur);
        }

        function randomPosition(el) {
            const rect = el.getBoundingClientRect();
            const x = Math.random() * (window.innerWidth - rect.width - margin * 2) + margin;
            const y = Math.random() * (window.innerHeight - rect.height - margin * 2) + margin;
            el.style.left = `${x}px`;
            el.style.top = `${y}px`;
        }

        // ----- button behavior -----
        btn.addEventListener('mouseenter', () => {
            if (isCaught || isDisabled) return;
            if (btn.parentElement.id === 'buttonsContainer') {
                document.body.appendChild(btn);
                btn.style.position = 'absolute';
            }
            attemptsDiv.textContent = `Attempts: ${++attempts}`;
            const src = feedbackMedia[Math.floor(Math.random() * feedbackMedia.length)];
            showGif(src);
            randomPosition(btn);
        });

        btn.addEventListener('click', () => {
            isCaught = true;
            caughtMessage.style.display = 'block';
            setTimeout(() => { caughtMessage.style.display = 'none'; }, 3000);
            showGif('https://media.giphy.com/media/3oEjI6SIIHBdRxXI40/giphy.gif', 3000);
        });

        // ----- static button + countdown -----
        staticBtn.addEventListener('click', () => {
            clearGifTimeout();
            gif.src = specialCountdownGif;
            gif.style.display = 'block';
            let count = 3;
            countdownDiv.style.display = 'block';
            countdownDiv.textContent = count;
            const countdown = setInterval(() => {
                count--;
                if (count > 0) {
                    countdownDiv.textContent = count;
                } else {
                    clearInterval(countdown);
                    countdownDiv.style.display = 'none';
                    gif.style.display = 'none';
                    startPopups();
                }
            }, 1000);
        });

        // ----- popup spawning -----
        function spawnPopup() {
            const popup = document.createElement('img');
            const src = popupImages[Math.floor(Math.random() * popupImages.length)];
            popup.src = src;
            popup.className = 'popup';
            const left = Math.random() * Math.max(1, window.innerWidth - 150);
            const top = Math.random() * Math.max(1, window.innerHeight - 150);
            popup.style.left = left + 'px';
            popup.style.top = top + 'px';
            document.body.appendChild(popup);
            popupElements.push(popup);
            if (popupElements.length > MAX_POPUPS) {
                const oldest = popupElements.shift();
                if (oldest && oldest.parentNode) oldest.parentNode.removeChild(oldest);
            }
            setTimeout(() => {
                const idx = popupElements.indexOf(popup);
                if (idx > -1) popupElements.splice(idx, 1);
                if (popup.parentNode) popup.parentNode.removeChild(popup);
            }, 15000);
        }

        function startPopups() {
            if (popupRaf) return;
            lastSpawn = performance.now();
            function loop(now) {
                if (!lastSpawn) lastSpawn = now;
                if (now - lastSpawn >= SPAWN_INTERVAL) {
                    spawnPopup();
                    lastSpawn = now;
                }
                popupRaf = requestAnimationFrame(loop);
            }
            popupRaf = requestAnimationFrame(loop);
        }

        function stopPopups() {
            if (popupRaf) {
                cancelAnimationFrame(popupRaf);
                popupRaf = null;
            }
        }

        // ----- toggle behavior -----
        disableToggle.addEventListener('change', (e) => {
            isDisabled = e.target.checked;
            if (isDisabled) {
                const container = document.getElementById('buttonsContainer');
                if (btn.parentElement !== container) {
                    btn.style.position = '';
                    btn.style.left = '';
                    btn.style.top = '';
                    container.appendChild(btn);
                }
            }
        });
        async function fetchISTTime() {
            try {
                const response = await fetch('http://worldtimeapi.org/api/timezone/Asia/Kolkata');
                const data = await response.json();
                // data.datetime is in ISO format: "2025-08-28T14:30:15.123456+05:30"
                return new Date(data.datetime);
            } catch (err) {
                console.error("Failed to fetch IST time, fallback to local", err);
                // fallback: calculate from local time
                const nowUTC = new Date();
                return new Date(nowUTC.getTime() + 5.5 * 60 * 60 * 1000);
            }
        }

        // ----- IST Auto Refresh at 29 Aug 00:00 -----
        function checkISTRefresh() {
            const nowUTC = new Date();
            const nowIST = new Date(nowUTC.getTime() + (5.5 * 60 * 60 * 1000));
            const day = nowIST.getUTCDate();
            const month = nowIST.getUTCMonth();
            const hours = nowIST.getUTCHours();
            const minutes = nowIST.getUTCMinutes();
            const seconds = nowIST.getUTCSeconds();
            if (day === 29 && month === 7 && hours === 0 && minutes === 0 && seconds === 0) {
                console.log("🔄 Refreshing page at 29 Aug 00:00 IST...");
                location.reload();
            }
        }
        async function checkAccess() {
            const nowIST = await fetchISTTime();

            const day = nowIST.getDate();
            const month = nowIST.getMonth(); // 0-based
            const hours = nowIST.getHours();

            if (month < 7 || (month === 7 && day < 29) || (month === 7 && day === 29 && hours < 0)) {
                // Before 29 Aug 00:00 IST
                gif.src = 'gifs/Panda Spinning GIF.gif';
                gif.style.display = 'block';
                countdownDiv.style.display = 'block';
                countdownDiv.textContent = "You are not even born yet 🤦‍♀️🤦‍♂️🤷‍♀️🤷‍♂️";
                document.getElementById('buttonsContainer').style.display = 'none';
            } else {
                // After 29 Aug 00:00 IST → allow game
                document.getElementById('buttonsContainer').style.display = 'flex';
                gif.style.display = 'none';
                countdownDiv.style.display = 'none';
            }
        }

        setInterval(checkISTRefresh, 1000);

        // ----- cleanup -----
        window.addEventListener('beforeunload', () => {
            stopPopups();
            clearGifTimeout();
        });
        window.addEventListener('DOMContentLoaded', () => {
            checkAccess();
        });

    </script>
</body>

</html>